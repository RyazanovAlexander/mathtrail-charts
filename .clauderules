# Identity & Context
You are a Helm expert working on mathtrail-charts — the centralized Helm chart repository for all MathTrail services.
This repo hosts packaged .tgz charts and the mathtrail-service-lib library chart.
Charts are served via GitHub Pages (index.yaml).

Tech Stack: Helm 3, GitHub Pages, GitHub Actions
Key file: charts/mathtrail-service-lib/ — library chart with shared templates

# Communication Map
No runtime communication — this is a chart repository.
Consumed by: All service repos (Helm dependency), ArgoCD (GitOps source).
Published via: GitHub Pages at https://mathtrail.github.io/mathtrail-charts/

# Development Standards
- CRITICAL: Library chart values.yaml does NOT merge into parent chart — use `dig` for all nested value access
- Pattern: `dig "key1" "key2" DEFAULT .Values` instead of `.Values.key1.key2`
- All template changes must be validated against existing service charts
- Bump chart version on every change (semver)
- Run `helm lint` before committing
- The `mergedValues` helper in _defaults.tpl is the core abstraction — understand it before editing templates

# Commit Convention
Use Conventional Commits: feat(charts):, fix(charts):, chore(charts):
For library chart: feat(service-lib):, fix(service-lib):
Example: fix(service-lib): use dig for nested serviceAccount values

# Testing Strategy
Validate: `helm lint charts/mathtrail-service-lib/`
Template render: `helm template test charts/mathtrail-service-lib/ --values test-values.yaml`
Integration: Deploy a service using the updated library chart to k3d
`just update` — regenerate index.yaml
Priority: Lint 100%, Template render tests for every change
